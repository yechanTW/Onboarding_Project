# Apollo Client

## **[공식 문서](#https://www.apollographql.com/)**

Apollo Client는 GraphQL 기반의 라이브러리로 , 로컬에서 전역 상태관리를 하기 위해 사용합니다. 원래는 GraphQL을 사용해서 서버와 통신을 하면서 반환한 값을 캐시로 보관하는데 , 일부 서비스는 서버 없이 완전히 독립적으로 작동할 수 있고 , 그런 경우에도 로컬 상태를 관리할 수 있습니다. 즉 추가적인 상태관리 라이브러리를 사용하지 않고도 충분히 전역 상태관리를 적용할 수 있습니다.

</br>

## 과정

1. apollo client가 쿼리를 통해 로컬 / 원격 필드를 요청하면 , 
2. cache는 요청받은 쿼리를 통해 동일한 쿼리가 캐싱되어 있는지 확인하고
3. 캐싱 되어있지 않다면 서버로 원격 필드를 요청하고
4. 서버는 요청 받은 필드를 확인 후 반환해주고
5. 캐시는 반환 받은 필드를 캐시에 저장하고 클라이언트에게 필드 반환합니다.

만약 3번에서 캐싱 되어있다면 , 서버에 따로 요청하지 않고 바로 반환합니다. 이처럼 Apollo Client는 캐시를 통해서 상태관리를 하고 로컬 상태도 관리할 수 있습니다. 이것에 대한 정책은 fetchPolicy를 통해서 정해집니다.

( 기존 상태 관리인 Redux는  액션이 발생하면 서버에 요청 후 , 응답을 받으면 리듀서에게 전달하고 리듀서는 스토어에 state tree를 업데이트 해서 state를 관리하는 방식이었습니다. 이는 컴포넌트 하나를 렌더링하기 위해서 너무 많은 과정이 필요하고 , 서버와 통신하는 과정에서 여러 endpoint를 인해 복잡도 증가 , overfetching/underfetching의 문제가 존재했습니다. )

</br>

## 반응 변수

Apollo Client 에서 제공하는 **makeVar** 함수를 통해 반응 변수를 만들 수 있는데 , 이 반응 변수는 Apollo Client 캐시 외부에 로컬 상태를 저장합니다.